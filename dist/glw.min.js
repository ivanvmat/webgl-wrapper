var glw={Vector2:function(t=0,i=t){this.x=t,this.y=i}};glw.Vector2.prototype={constructor:glw.Vector2,set:function(t,i=t){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return i?(this.x=t.x+i.x,this.y=t.y+i.y):(this.x=this.x+t.x,this.y=this.y+t.y),this},sub:function(t,i){return i?(this.x=t.x-i.x,this.y=t.y-i.y):(this.x=this.x-t.x,this.y=this.y-t.y),this},multiply:function(t){return t instanceof glw.Vector2?(this.x=this.x*t.x,this.y=this.y*t.y,this):this.scale(t)},divide:function(t){return t instanceof glw.Vector2?(this.x=this.x/t.x,this.y=this.y/t.y,this):this.scale(1/t)},inverse:function(t=this){return this.x=1/t.x,this.y=1/t.y,this},length:function(){let t=this.x,i=this.y;return Math.sqrt(t*t+i*i)},distance:function(t){if(t){let i=t.x-this.x,s=t.y-this.y;return Math.sqrt(i*i+s*s)}return this.length()},squaredLength:function(){let t=this.x,i=this.y;return t*t+i*i},squaredDistance:function(t){let i=t.x-this.x,s=t.y-this.y;return i*i+s*s},negate:function(t=this){return this.x=-t.x,this.y=-t.y,this},cross:function(t,i){return i?t.x*i.y-t.y*i.x:this.x*i.y-this.y*i.x},scale:function(t){return this.x=this.x*t,this.y=this.y*t,this},normalize:function(){let t=this.x*this.x+this.y*this.y;return t>0&&(t=1/Math.sqrt(t)),this.x=this.x*t,this.y=this.y*t,this},dot:function(t){return this.x*t.x+this.y*t.y},equals:function(t){return this.x===t.x&&this.y===t.y},applyMatrix3:function(t){return this.x=t.m00*this.x+t.m10*this.y+t.m20,this.y=t.m01*this.x+t.m11*this.y+t.m21,this},applyMatrix4:function(t){return this.x=t.m00*this.x+t.m10*this.y+t.m30,this.y=t.m01*this.x+t.m11*this.y+t.m31,this},lerp:function(t,i){return this.x=this.x+i*(t.x-this.x),this.y=this.y+i*(t.y-this.y),this},clone:function(){return new glw.Vector2(this.x,this.y)},fromArray:function(t,i=0){return this.x=t[i],this.y=t[i+1],this},toArray:function(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}},glw.Vector3=function(t=0,i=t,s=t){this.x=t,this.y=i,this.z=s},glw.Vector3.prototype={constructor:glw.Vector3,set:function(t,i=t,s=t){return this.x=t,this.y=i,this.z=s,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return i?(this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z):(this.x=this.x+t.x,this.y=this.y+t.y,this.z=this.z+t.z),this},sub:function(t,i){return i?(this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z):(this.x=this.x-t.x,this.y=this.y-t.y,this.z=this.z-t.z),this},multiply:function(t){return t instanceof glw.Vector3?(this.x=this.x*t.x,this.y=this.y*t.y,this.z=this.z*t.z,this):this.scale(t)},divide:function(t){return t instanceof glw.Vector3?(this.x=this.x/t.x,this.y=this.y/t.y,this.z=this.z/t.z,this):this.scale(1/t)},inverse:function(t=this){return this.x=1/t.x,this.y=1/t.y,this.z=1/t.z,this},length:function(){let t=this.x,i=this.y,s=this.z;return Math.sqrt(t*t+i*i+s*s)},distance:function(t){if(t){let i=t.x-this.x,s=t.y-this.y,e=t.z-this.z;return Math.sqrt(i*i+s*s+e*e)}return this.length()},squaredLength:function(){let t=this.x,i=this.y,s=this.z;return t*t+i*i+s*s},squaredDistance:function(t){let i=t.x-this.x,s=t.y-this.y,e=t.z-this.z;return i*i+s*s+e*e},negate:function(t=this){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},cross:function(t,i){return i?(this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x):(this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x),this},scale:function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this},normalize:function(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t>0&&(t=1/Math.sqrt(t)),this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},applyMatrix3:function(t){let i=this.x,s=this.y,e=this.z;return this.x=i*t.m00+s*t.m10+e*t.m20,this.y=i*t.m01+s*t.m11+e*t.m21,this.z=i*t.m02+s*t.m12+e*t.m22,this},applyMatrix4:function(t){let i=this.x,s=this.y,e=this.z,h=t.m03*i+t.m13*s+t.m23*e+t.m33;return h=h||1,this.x=(t.m00*i+t.m10*s+t.m20*e+t.m30)/h,this.y=(t.m01*i+t.m11*s+t.m21*e+t.m31)/h,this.z=(t.m02*i+t.m12*s+t.m22*e+t.m32)/h,this},scaleRotateMatrix4:function(t){let i=this.x,s=this.y,e=this.z,h=t.m03*i+t.m13*s+t.m23*e+t.m33;return h=h||1,this.x=(t.m00*i+t.m10*s+t.m20*e)/h,this.y=(t.m01*i+t.m11*s+t.m21*e)/h,this.z=(t.m02*i+t.m12*s+t.m22*e)/h,this},transformDirection:function(t){let i=this.x,s=this.y,e=this.z;return this.x=t.m00*i+t.m10*s+t.m20*e,this.y=t.m01*i+t.m11*s+t.m21*e,this.z=t.m02*i+t.m12*s+t.m22*e,this.normalize()},applyQuaternion:function(t){let i=this.x,s=this.y,e=this.z,h=t.x,r=t.y,n=t.z,a=t.w,m=r*e-n*s,o=n*i-h*e,l=h*s-r*i,u=r*l-n*o,c=n*m-h*l,g=h*o-r*m,d=2*a;return m*=d,o*=d,l*=d,u*=2,c*=2,g*=2,this.x=i+m+u,this.y=s+o+c,this.z=e+l+g,this},angle:function(t){let i=new glw.Vector3(0,0,0),s=new glw.Vector3(0,0,0);this.copy(i,this),this.copy(s,t),this.normalize(i,i),this.normalize(s,s);let e=this.dot(i,s);return e>1?0:e<-1?Math.PI:Math.acos(e)},lerp:function(t,i){return this.x=this.x+i*(t.x-this.x),this.y=this.y+i*(t.y-this.y),this.z=this.z+i*(t.z-this.z),this},clone:function(){return new glw.Vector3(this.x,this.y,this.z)},fromArray:function(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},glw.Vector4=function(t=0,i=t,s=t,e=t){this.x=t,this.y=i,this.z=s,this.w=e},glw.Vector4.prototype={constructor:glw.Vector4,set:function(t,i=t,s=t,e=t){return this.x=t,this.y=i,this.z=s,this.w=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},add:function(t,i){return i?(this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w):(this.x=this.x+t.x,this.y=this.y+t.y,this.z=this.z+t.z,this.w=this.w+t.w),this},sub:function(t,i){return i?(this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w):(this.x=this.x-t.x,this.y=this.y-t.y,this.w=this.w-t.w),this},multiply:function(t){return t instanceof glw.Vector4?(this.x=this.x*t.x,this.y=this.y*t.y,this.z=this.z*t.z,this.w=this.w*t.w,this):this.scale(t)},divide:function(t){return t instanceof glw.Vector4?(this.x=this.x/t.x,this.y=this.y/t.y,this.z=this.z/t.z,this.w=this.w/t.w,this):this.scale(1/t)},inverse:function(t=this){return this.x=1/t.x,this.y=1/t.y,this.z=1/t.z,this.w=1/t.w,this},length:function(){let t=this.x,i=this.y,s=this.z,e=this.w;return Math.sqrt(t*t+i*i+s*s+e*e)},squaredLength:function(){let t=this.x,i=this.y,s=this.z,e=this.w;return t*t+i*i+s*s+e*e},negate:function(t=this){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},scale:function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},normalize:function(){let t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return t>0&&(t=1/Math.sqrt(t)),this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lerp:function(t,i){return this.x=this.x+i*(t.x-this.x),this.y=this.y+i*(t.y-this.y),this.z=this.z+i*(t.z-this.z),this.w=this.w+i*(t.w-this.w),this},fromArray:function(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},glw.Matrix3=function(t=1,i=0,s=0,e=0,h=1,r=0,n=0,a=0,m=1){this.m00=t,this.m01=i,this.m02=s,this.m10=e,this.m11=h,this.m12=r,this.m20=n,this.m21=a,this.m22=m},glw.Matrix3.prototype={constructor:glw.Matrix3,set:function(t,i,s,e,h,r,n,a,m){return this.m00=t,this.m01=i,this.m02=s,this.m10=e,this.m11=h,this.m12=r,this.m20=n,this.m21=a,this.m22=m,this},copy:function(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this},add:function(t,i){return i?(this.m00=t.m00+i.m00,this.m01=t.m01+i.m01,this.m02=t.m02+i.m02,this.m10=t.m10+i.m10,this.m11=t.m11+i.m11,this.m12=t.m12+i.m12,this.m20=t.m20+i.m20,this.m21=t.m21+i.m21,this.m22=t.m22+i.m22):(this.m00=this.m00+t.m00,this.m01=this.m01+t.m01,this.m02=this.m02+t.m02,this.m10=this.m10+t.m10,this.m11=this.m11+t.m11,this.m12=this.m12+t.m12,this.m20=this.m20+t.m20,this.m21=this.m21+t.m21,this.m22=this.m22+t.m22),this},sub:function(t,i){return i?(this.m00=t.m00-i.m00,this.m01=t.m01-i.m01,this.m02=t.m02-i.m02,this.m10=t.m10-i.m10,this.m11=t.m11-i.m11,this.m12=t.m12-i.m12,this.m20=t.m20-i.m20,this.m21=t.m21-i.m21,this.m22=t.m22-i.m22):(this.m00=this.m00-t.m00,this.m01=this.m01-t.m01,this.m02=this.m02-t.m02,this.m10=this.m10-t.m10,this.m11=this.m11-t.m11,this.m12=this.m12-t.m12,this.m20=this.m20-t.m20,this.m21=this.m21-t.m21,this.m22=this.m22-t.m22),this},multiply:function(t,i){if(i){let s=t.m00,e=t.m01,h=t.m02,r=t.m10,n=t.m11,a=t.m12,m=t.m20,o=t.m21,l=t.m22,u=i.m00,c=i.m01,g=i.m02,d=i.m10,f=i.m11,p=i.m12,x=i.m20,y=i.m21,w=i.m22;this.m00=u*s+c*r+g*m,this.m01=u*e+c*n+g*o,this.m02=u*h+c*a+g*l,this.m10=d*s+f*r+p*m,this.m11=d*e+f*n+p*o,this.m12=d*h+f*a+p*l,this.m20=x*s+y*r+w*m,this.m21=x*e+y*n+w*o,this.m22=x*h+y*a+w*l}else{let i=this.m00,s=this.m01,e=this.m02,h=this.m10,r=this.m11,n=this.m12,a=this.m20,m=this.m21,o=this.m22,l=t.m00,u=t.m01,c=t.m02,g=t.m10,d=t.m11,f=t.m12,p=t.m20,x=t.m21,y=t.m22;this.m00=l*i+u*h+c*a,this.m01=l*s+u*r+c*m,this.m02=l*e+u*n+c*o,this.m10=g*i+d*h+f*a,this.m11=g*s+d*r+f*m,this.m12=g*e+d*n+f*o,this.m20=p*i+x*h+y*a,this.m21=p*s+x*r+y*m,this.m22=p*e+x*n+y*o}return this},multiplyScalar:function(t){return this.m00=this.m00*t,this.m01=this.m01*t,this.m02=this.m02*t,this.m10=this.m10*t,this.m11=this.m11*t,this.m12=this.m12*t,this.m20=this.m20*t,this.m21=this.m21*t,this.m22=this.m22*t,this},scale:function(t,i=this){let s=t.x,e=t.y;return this.m00=s*i.m00,this.m01=s*i.m01,this.m02=s*i.m02,this.m10=e*i.m10,this.m11=e*i.m11,this.m12=e*i.m12,this.m20=i.m20,this.m21=i.m21,this.m22=i.m22,this},translate:function(t,i=this){let s=i.m00,e=i.m01,h=i.m02,r=i.m10,n=i.m11,a=i.m12,m=i.m20,o=i.m21,l=i.m22,u=t.x,c=t.y;return this.m00=s,this.m01=e,this.m02=h,this.m10=r,this.m11=n,this.m12=a,this.m20=u*s+c*r+m,this.m21=u*e+c*n+o,this.m22=u*h+c*a+l,this},rotate:function(t,i=this){let s=i.m00,e=i.m01,h=i.m02,r=i.m10,n=i.m11,a=i.m12,m=i.m20,o=i.m21,l=i.m22,u=Math.sin(t),c=Math.cos(t);return this.m00=c*s+u*r,this.m01=c*e+u*n,this.m02=c*h+u*a,this.m10=c*r-u*s,this.m11=c*n-u*e,this.m12=c*a-u*h,this.m20=m,this.m21=o,this.m22=l,this},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this},fromMatrix4:function(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this},fromQuaternion:function(t){let i=t.x,s=t.y,e=t.z,h=t.w,r=i+i,n=s+s,a=e+e,m=i*r,o=s*r,l=s*n,u=e*r,c=e*n,g=e*a,d=h*r,f=h*n,p=h*a;return this.m00=1-l-g,this.m10=o-p,this.m20=u+f,this.m01=o+p,this.m11=1-m-g,this.m21=c-d,this.m02=u-f,this.m12=c+d,this.m22=1-m-l,this},fromBasis:function(t,i,s){return this.set(t.x,t.y,t.z,i.x,i.y,i.z,s.x,s.y,s.z),this},inverse:function(t=this){let i=t.m00,s=t.m01,e=t.m02,h=t.m10,r=t.m11,n=t.m12,a=t.m20,m=t.m21,o=t.m22,l=o*r-n*m,u=-o*h+n*a,c=m*h-r*a,g=i*l+s*u+e*c;return g?(g=1/g,this.m00=l*g,this.m01=(-o*s+e*m)*g,this.m02=(n*s-e*r)*g,this.m10=u*g,this.m11=(o*i-e*a)*g,this.m12=(-n*i+e*h)*g,this.m20=c*g,this.m21=(-m*i+s*a)*g,this.m22=(r*i-s*h)*g,this):null},getNormalMatrix:function(t){let i=t.m00,s=t.m01,e=t.m02,h=t.m03,r=t.m10,n=t.m11,a=t.m12,m=t.m13,o=t.m20,l=t.m21,u=t.m22,c=t.m23,g=t.m30,d=t.m31,f=t.m32,p=t.m33,x=i*n-s*r,y=i*a-e*r,w=i*m-h*r,M=s*a-e*n,E=s*m-h*n,b=e*m-h*a,A=o*d-l*g,z=o*f-u*g,v=o*p-c*g,T=l*f-u*d,R=l*p-c*d,F=u*p-c*f,_=x*F-y*R+w*T+M*v-E*z+b*A;return _?(_=1/_,this.m00=(n*F-a*R+m*T)*_,this.m01=(a*v-r*F-m*z)*_,this.m02=(r*R-n*v+m*A)*_,this.m10=(e*R-s*F-h*T)*_,this.m11=(i*F-e*v+h*z)*_,this.m12=(s*v-i*R-h*A)*_,this.m20=(d*b-f*E+p*M)*_,this.m21=(f*w-g*b-p*y)*_,this.m22=(g*E-d*w+p*x)*_,this):null},transpose:function(t){if(out===a){let i=t.m01,s=t.m02,e=t.m12;this.m01=t.m10,this.m02=t.m20,this.m10=i,this.m12=t.m21,this.m20=s,this.m21=e}else this.m00=t.m00,this.m01=t.m10,this.m02=t.m20,this.m10=t.m01,this.m11=t.m11,this.m12=t.m21,this.m20=t.m02,this.m21=t.m12,this.m22=t.m22;return this},determinant:function(t){let i=t.m00,s=t.m01,e=t.m02,h=t.m10,r=t.m11,n=t.m12,a=t.m20,m=t.m21,o=t.m22;return i*(o*r-n*m)+s*(-o*h+n*a)+e*(m*h-r*a)},projection:function(t,i){return this.m00=2/t,this.m01=0,this.m02=0,this.m10=0,this.m11=-2/i,this.m12=0,this.m20=-1,this.m21=1,this.m22=1,this},fromArray:function(t,i=0){return this.m00=t[i],this.m01=t[i+1],this.m02=t[i+2],this.m10=t[i+3],this.m11=t[i+4],this.m12=t[i+5],this.m20=t[i+6],this.m21=t[i+7],this.m22=t[i+8],this},toArray:function(t=[],i=0){return t[i]=this.m00,t[i+1]=this.m01,t[i+2]=this.m02,t[i+3]=this.m10,t[i+4]=this.m11,t[i+5]=this.m12,t[i+6]=this.m20,t[i+7]=this.m21,t[i+8]=this.m22,t}},glw.Matrix4=function(t=1,i=0,s=0,e=0,h=0,r=1,n=0,a=0,m=0,o=0,l=1,u=0,c=0,g=0,d=0,f=1){this.m00=t,this.m01=i,this.m02=s,this.m03=e,this.m10=h,this.m11=r,this.m12=n,this.m13=a,this.m20=m,this.m21=o,this.m22=l,this.m23=u,this.m30=c,this.m31=g,this.m32=d,this.m33=f},glw.Matrix4.prototype={constructor:glw.Matrix4,get x(){return this.m30},set x(t){this.m30=t},get y(){return this.m31},set y(t){this.m31=t},get z(){return this.m32},set z(t){this.m32=t},get z(){return this.m33},set z(t){this.m33=t},set:function(t,i,s,e,h,r,n,a,m,o,l,u,c,g,d,f){return this.m00=t,this.m01=i,this.m02=s,this.m03=e,this.m10=h,this.m11=r,this.m12=n,this.m13=a,this.m20=m,this.m21=o,this.m22=l,this.m23=u,this.m30=c,this.m31=g,this.m32=d,this.m33=f,this},copy:function(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this.m23=t.m23,this.m30=t.m30,this.m31=t.m31,this.m32=t.m32,this.m33=t.m33,this},add:function(t,i){return this.m00=t.m00+i.m00,this.m01=t.m01+i.m01,this.m02=t.m02+i.m02,this.m03=t.m03+i.m03,this.m10=t.m10+i.m10,this.m11=t.m11+i.m11,this.m12=t.m12+i.m12,this.m13=t.m13+i.m13,this.m20=t.m20+i.m20,this.m21=t.m21+i.m21,this.m22=t.m22+i.m22,this.m23=t.m23+i.m23,this.m30=t.m30+i.m30,this.m31=t.m31+i.m31,this.m32=t.m32+i.m32,this.m33=t.m33+i.m33,this},sub:function(t,i){return this.m00=t.m00-i.m00,this.m01=t.m01-i.m01,this.m02=t.m02-i.m02,this.m03=t.m03-i.m03,this.m10=t.m10-i.m10,this.m11=t.m11-i.m11,this.m12=t.m12-i.m12,this.m13=t.m13-i.m13,this.m20=t.m20-i.m20,this.m21=t.m21-i.m21,this.m22=t.m22-i.m22,this.m23=t.m23-i.m23,this.m30=t.m30-i.m30,this.m31=t.m31-i.m31,this.m32=t.m32-i.m32,this.m33=t.m33-i.m33,this},multiply:function(t,i){if(i){let s=t.m00,e=t.m01,h=t.m02,r=t.m03,n=t.m10,a=t.m11,m=t.m12,o=t.m13,l=t.m20,u=t.m21,c=t.m22,g=t.m23,d=t.m30,f=t.m31,p=t.m32,x=t.m33,y=i.m00,w=i.m01,M=i.m02,E=i.m03;this.m00=y*s+w*n+M*l+E*d,this.m01=y*e+w*a+M*u+E*f,this.m02=y*h+w*m+M*c+E*p,this.m03=y*r+w*o+M*g+E*x,y=i.m10,w=i.m11,M=i.m12,E=i.m13,this.m10=y*s+w*n+M*l+E*d,this.m11=y*e+w*a+M*u+E*f,this.m12=y*h+w*m+M*c+E*p,this.m13=y*r+w*o+M*g+E*x,y=i.m20,w=i.m21,M=i.m22,E=i.m23,this.m20=y*s+w*n+M*l+E*d,this.m21=y*e+w*a+M*u+E*f,this.m22=y*h+w*m+M*c+E*p,this.m23=y*r+w*o+M*g+E*x,y=i.m30,w=i.m31,M=i.m32,E=i.m33,this.m30=y*s+w*n+M*l+E*d,this.m31=y*e+w*a+M*u+E*f,this.m32=y*h+w*m+M*c+E*p,this.m33=y*r+w*o+M*g+E*x}else{let i=this.m00,s=this.m01,e=this.m02,h=this.m03,r=this.m10,n=this.m11,a=this.m12,m=this.m13,o=this.m20,l=this.m21,u=this.m22,c=this.m23,g=this.m30,d=this.m31,f=this.m32,p=this.m33,x=t.m00,y=t.m01,w=t.m02,M=t.m03;this.m00=x*i+y*r+w*o+M*g,this.m01=x*s+y*n+w*l+M*d,this.m02=x*e+y*a+w*u+M*f,this.m03=x*h+y*m+w*c+M*p,x=t.m10,y=t.m11,w=t.m12,M=t.m13,this.m10=x*i+y*r+w*o+M*g,this.m11=x*s+y*n+w*l+M*d,this.m12=x*e+y*a+w*u+M*f,this.m13=x*h+y*m+w*c+M*p,x=t.m20,y=t.m21,w=t.m22,M=t.m23,this.m20=x*i+y*r+w*o+M*g,this.m21=x*s+y*n+w*l+M*d,this.m22=x*e+y*a+w*u+M*f,this.m23=x*h+y*m+w*c+M*p,x=t.m30,y=t.m31,w=t.m32,M=t.m33,this.m30=x*i+y*r+w*o+M*g,this.m31=x*s+y*n+w*l+M*d,this.m32=x*e+y*a+w*u+M*f,this.m33=x*h+y*m+w*c+M*p}return this},multiplyScalar:function(t){return this.m00=this.m00*t,this.m01=this.m01*t,this.m02=this.m02*t,this.m03=this.m03*t,this.m10=this.m10*t,this.m11=this.m11*t,this.m12=this.m12*t,this.m13=this.m13*t,this.m20=this.m20*t,this.m21=this.m21*t,this.m22=this.m22*t,this.m23=this.m23*t,this.m30=this.m30*t,this.m31=this.m31*t,this.m32=this.m32*t,this.m33=this.m33*t,this},scale:function(t,i=this){t="number"==typeof t?{x:t,y:t,z:t}:t;let s=t.x,e=t.y,h=t.z;return this.m00=i.m00*s,this.m01=i.m01*s,this.m02=i.m02*s,this.m03=i.m03*s,this.m10=i.m10*e,this.m11=i.m11*e,this.m12=i.m12*e,this.m13=i.m13*e,this.m20=i.m20*h,this.m21=i.m21*h,this.m22=i.m22*h,this.m23=i.m23*h,this.m30=i.m30,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this},translate:function(t,i=this){let s,e,h,r,n,m,o,l,u,c,g,d,f=t.x,p=t.y,x=t.z;return i===this?(this.m30=i.m00*f+i.m10*p+i.m20*x+i.m30,this.m31=i.m01*f+i.m11*p+i.m21*x+i.m31,this.m32=i.m02*f+i.m12*p+i.m22*x+i.m32,this.m33=i.m03*f+i.m13*p+i.m23*x+i.m33):(s=i.m00,e=i.m01,h=i.m02,r=i.m03,n=i.m10,m=i.m11,o=i.m12,l=i.m13,u=i.m20,c=i.m21,g=i.m22,d=i.m23,this.m00=s,this.m01=e,this.m02=h,this.m03=r,this.m10=n,this.m11=m,this.m12=o,this.m13=l,this.m20=u,this.m21=c,this.m22=g,this.m23=d,this.m30=s*f+n*p+u*x+a.m30,this.m31=e*f+m*p+c*x+a.m31,this.m32=h*f+o*p+g*x+a.m32,this.m33=r*f+l*p+d*x+a.m33),this},rotate:function(t,i,s=this){let e,h,r,n,m,o,l,u,c,g,d,f,p,x,y,w,M,E,b,A,z,v,T,R,F=i.x,_=i.y,S=i.z,C=Math.hypot(F,_,S);return Math.abs(C)<1e-6?null:(C=1/C,F*=C,_*=C,S*=C,e=Math.sin(t),h=Math.cos(t),r=1-h,n=s.m00,m=s.m01,o=s.m02,l=s.m03,u=s.m10,c=s.m11,g=s.m12,d=s.m13,f=s.m20,p=s.m21,x=s.m22,y=s.m23,w=F*F*r+h,M=_*F*r+S*e,E=S*F*r-_*e,b=F*_*r-S*e,A=_*_*r+h,z=S*_*r+F*e,v=F*S*r+_*e,T=_*S*r-F*e,R=S*S*r+h,this.m00=n*w+u*M+f*E,this.m01=m*w+c*M+p*E,this.m02=o*w+g*M+x*E,this.m03=l*w+d*M+y*E,this.m10=n*b+u*A+f*z,this.m11=m*b+c*A+p*z,this.m12=o*b+g*A+x*z,this.m13=l*b+d*A+y*z,this.m20=n*v+u*T+f*R,this.m21=m*v+c*T+p*R,this.m22=o*v+g*T+x*R,this.m23=l*v+d*T+y*R,a!==this&&(this.m30=s.m30,this.m31=s.m31,this.m32=s.m32,this.m33=s.m33),this)},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=1,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=1,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=1,this},fromPerspective:function({fov:t,aspect:i,near:s,far:e}={}){let h=1/Math.tan(t/2),r=1/(s-e);return this.m00=h/i,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=h,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=(e+s)*r,this.m23=-1,this.m30=0,this.m31=0,this.m32=2*e*s*r,this.m33=0,this},fromOrthogonal:function({left:t,right:i,bottom:s,top:e,near:h,far:r}){let n=1/(t-i),a=1/(s-e),m=1/(h-r);return this.m00=-2*n,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=-2*a,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=2*m,this.m23=0,this.m30=(t+i)*n,this.m31=(e+s)*a,this.m32=(r+h)*m,this.m33=1,this},fromQuaternion:function(t){let i=t.x,s=t.y,e=t.z,h=t.w,r=i+i,n=s+s,a=e+e,m=i*r,o=s*r,l=s*n,u=e*r,c=e*n,g=e*a,d=h*r,f=h*n,p=h*a;return this.m00=1-l-g,this.m01=o+p,this.m02=u-f,this.m03=0,this.m10=o-p,this.m11=1-m-g,this.m12=c+d,this.m13=0,this.m20=u+f,this.m21=c-d,this.m22=1-m-l,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=1,this},setPosition:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},inverse:function(t=this){let i=t.m00,s=t.m01,e=t.m02,h=t.m03,r=t.m10,n=t.m11,a=t.m12,m=t.m13,o=t.m20,l=t.m21,u=t.m22,c=t.m23,g=t.m30,d=t.m31,f=t.m32,p=t.m33,x=i*n-s*r,y=i*a-e*r,w=i*m-h*r,M=s*a-e*n,E=s*m-h*n,b=e*m-h*a,A=o*d-l*g,z=o*f-u*g,v=o*p-c*g,T=l*f-u*d,R=l*p-c*d,F=u*p-c*f,_=x*F-y*R+w*T+M*v-E*z+b*A;return _?(_=1/_,this.m00=(n*F-a*R+m*T)*_,this.m01=(e*R-s*F-h*T)*_,this.m02=(d*b-f*E+p*M)*_,this.m03=(u*E-l*b-c*M)*_,this.m10=(a*v-r*F-m*z)*_,this.m11=(i*F-e*v+h*z)*_,this.m12=(f*w-g*b-p*y)*_,this.m13=(o*b-u*w+c*y)*_,this.m20=(r*R-n*v+m*A)*_,this.m21=(s*v-i*R-h*A)*_,this.m22=(g*E-d*w+p*x)*_,this.m23=(l*w-o*E-c*x)*_,this.m30=(n*z-r*T-a*A)*_,this.m31=(i*T-s*z+e*A)*_,this.m32=(d*y-g*M-f*x)*_,this.m33=(o*M-l*y+u*x)*_,this):null},compose:function(t,i,s){let e=t.x,h=t.y,r=t.z,n=t.w,a=e+e,m=h+h,o=r+r,l=e*a,u=e*m,c=e*o,g=h*m,d=h*o,f=r*o,p=n*a,x=n*m,y=n*o,w=s.x,M=s.y,E=s.z;return this.m00=(1-(g+f))*w,this.m01=(u+y)*w,this.m02=(c-x)*w,this.m03=0,this.m10=(u-y)*M,this.m11=(1-(l+f))*M,this.m12=(d+p)*M,this.m13=0,this.m20=(c+x)*E,this.m21=(d-p)*E,this.m22=(1-(l+g))*E,this.m23=0,this.m30=i.x,this.m31=i.y,this.m32=i.z,this.m33=1,this},getRotation:function(t){const i=new glw.Vector3(0,0,0);let s=i;this.getScaling(s);let e=1/s.x,h=1/s.y,r=1/s.z,n=this.m00*e,a=this.m01*h,m=this.m02*r,o=this.m10*e,l=this.m11*h,u=this.m12*r,c=this.m20*e,g=this.m21*h,d=this.m22*r,f=n+l+d,p=0;return f>0?(p=2*Math.sqrt(f+1),t.w=.25*p,t.x=(u-g)/p,t.y=(c-m)/p,t.z=(a-o)/p):n>l&&n>d?(p=2*Math.sqrt(1+n-l-d),t.w=(u-g)/p,t.x=.25*p,t.y=(a+o)/p,t.z=(c+m)/p):l>d?(p=2*Math.sqrt(1+l-n-d),t.w=(c-m)/p,t.x=(a+o)/p,t.y=.25*p,t.z=(u+g)/p):(p=2*Math.sqrt(1+d-n-l),t.w=(a-o)/p,t.x=(c+m)/p,t.y=(u+g)/p,t.z=.25*p),t},getTranslation:function(t){return t.x=this.m30,t.y=this.m31,t.z=this.m32,t},getScaling:function(t){let i=this.m00,s=this.m01,e=this.m02,h=this.m10,r=this.m11,n=this.m12,a=this.m20,m=this.m21,o=this.m22;return t.x=Math.hypot(i,s,e),t.y=Math.hypot(h,r,n),t.z=Math.hypot(a,m,o),t},getMaxScaleOnAxis:function(){let t=this.m00,i=this.m01,s=this.m02,e=this.m10,h=this.m11,r=this.m12,n=this.m20,a=this.m21,m=this.m22;const o=t*t+i*i+s*s,l=e*e+h*h+r*r,u=n*n+a*a+m*m;return Math.sqrt(Math.max(o,l,u))},lookAt:function(t,i,s){let e=t.x,h=t.y,r=t.z,n=s.x,a=s.y,m=s.z,o=e-i.x,l=h-i.y,u=r-i.z,c=o*o+l*l+u*u;0===c?u=1:(c=1/Math.sqrt(c),o*=c,l*=c,u*=c);let g=a*u-m*l,d=m*o-n*u,f=n*l-a*o;return c=g*g+d*d+f*f,0===c&&(m?n+=1e-6:a?m+=1e-6:a+=1e-6,g=a*u-m*l,d=m*o-n*u,f=n*l-a*o,c=g*g+d*d+f*f),c=1/Math.sqrt(c),g*=c,d*=c,f*=c,this.m00=g,this.m01=d,this.m02=f,this.m03=0,this.m10=l*f-u*d,this.m11=u*g-o*f,this.m12=o*d-l*g,this.m13=0,this.m20=o,this.m21=l,this.m22=u,this.m23=0,this.m30=e,this.m31=h,this.m32=r,this.m33=1,this},transpose:function(t){if(this===t){let i=t.m01,s=t.m02,e=t.m03,h=t.m12,r=t.m13,n=t.m23;this.m01=t.m10,this.m02=t.m20,this.m03=t.m30,this.m10=i,this.m12=t.m21,this.m13=t.m31,this.m20=s,this.m21=h,this.m23=t.m32,this.m30=e,this.m31=r,this.m32=n}else this.m00=t.m00,this.m01=t.m10,this.m02=t.m20,this.m03=t.m30,this.m10=t.m01,this.m11=t.m11,this.m12=t.m21,this.m13=t.m31,this.m20=t.m02,this.m21=t.m12,this.m22=t.m22,this.m23=t.m32,this.m30=t.m03,this.m31=t.m13,this.m32=t.m23,this.m33=t.m33;return this},determinant:function(){let t=this.m00,i=this.m01,s=this.m02,e=this.m03,h=this.m10,r=this.m11,n=this.m12,a=this.m13,m=this.m20,o=this.m21,l=this.m22,u=this.m23,c=this.m30,g=this.m31,d=this.m32,f=this.m33,p=t*r-i*h,x=t*n-s*h,y=t*a-e*h,w=i*n-s*r,M=i*a-e*r,E=s*a-e*n,b=m*g-o*c,A=m*d-l*c,z=m*f-u*c,v=o*d-l*g,T=o*f-u*g,R=l*f-u*d;return p*R-x*T+y*v+w*z-M*A+E*b},fromArray:function(t,i=0){return this.m00=t[i],this.m01=t[i+1],this.m02=t[i+2],this.m03=t[i+3],this.m10=t[i+4],this.m11=t[i+5],this.m12=t[i+6],this.m13=t[i+7],this.m20=t[i+8],this.m21=t[i+9],this.m22=t[i+10],this.m23=t[i+11],this.m30=t[i+12],this.m31=t[i+13],this.m32=t[i+14],this.m33=t[i+15],this},toArray:function(t=[],i=0){return t[i]=this.m00,t[i+1]=this.m01,t[i+2]=this.m02,t[i+3]=this.m03,t[i+4]=this.m10,t[i+5]=this.m11,t[i+6]=this.m12,t[i+7]=this.m13,t[i+8]=this.m20,t[i+9]=this.m21,t[i+10]=this.m22,t[i+11]=this.m23,t[i+12]=this.m30,t[i+13]=this.m31,t[i+14]=this.m32,t[i+15]=this.m33,t}},glw.Euler=function(t=0,i=t,s=t,e="YXZ"){this.order=e,this.onChange=(()=>{});let h=t,r=i,n=s;Object.defineProperties(this,{x:{get:function(){return h},set:function(t){h=t,this.onChange()}},y:{get:function(){return r},set:function(t){r=t,this.onChange()}},z:{get:function(){return n},set:function(t){n=t,this.onChange()}}})},glw.Euler.prototype={constructor:glw.Euler,set(t,i=t,s=t){return this.x=t,this.y=i,this.z=s,this.onChange(),this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.onChange(),this},reorder:function(t){return this.order=t,this.onChange(),this},fromRotationMatrix:function(t,i=this.order){let s=this.onChange;this.onChange=(()=>{});let e=t.toArray();return"XYZ"===i?(this.y=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(this.x=Math.atan2(-e[9],e[10]),this.z=Math.atan2(-e[4],e[0])):(this.x=Math.atan2(e[6],e[5]),this.z=0)):"YXZ"===i?(this.x=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(this.y=Math.atan2(e[8],e[10]),this.z=Math.atan2(e[1],e[5])):(this.y=Math.atan2(-e[2],e[0]),this.z=0)):"ZXY"===i?(this.x=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(this.y=Math.atan2(-e[2],e[10]),this.z=Math.atan2(-e[4],e[5])):(this.y=0,this.z=Math.atan2(e[1],e[0]))):"ZYX"===i?(this.y=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(this.x=Math.atan2(e[6],e[10]),this.z=Math.atan2(e[1],e[0])):(this.x=0,this.z=Math.atan2(-e[4],e[5]))):"YZX"===i?(this.z=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(this.x=Math.atan2(-e[9],e[5]),this.y=Math.atan2(-e[2],e[0])):(this.x=0,this.y=Math.atan2(e[8],e[10]))):"XZY"===i&&(this.z=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(this.x=Math.atan2(e[6],e[5]),this.y=Math.atan2(e[8],e[0])):(this.x=Math.atan2(-e[9],e[10]),this.y=0)),this.onChange=s,this},fromQuaternion:function(t,i=this.order){const s=new glw.Matrix4;return s.fromQuaternion(t),this.fromRotationMatrix(s,i)},clone(){return new glw.Euler(this.x,this.y,this.z)}},glw.Quaternion=function(t=0,i=0,s=0,e=1){this.onChange=(()=>{});let h=t,r=i,n=s,a=e;Object.defineProperties(this,{x:{get:function(){return h},set:function(t){h=t,this.onChange()}},y:{get:function(){return r},set:function(t){r=t,this.onChange()}},z:{get:function(){return n},set:function(t){n=t,this.onChange()}},w:{get:function(){return a},set:function(t){a=t,this.onChange()}}})},glw.Quaternion.prototype={constructor:glw.Quaternion,set:function(t,i=t,s=t,e=t){return this.x=t,this.y=i,this.z=s,this.w=e,this.onChange(),this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this.onChange(),this},add:function(t,i){return i?(this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w):(this.x=this.x+t.x,this.y=this.y+t.y,this.z=this.z+t.z,this.w=this.w+t.w),this},multiply:function(t,i){if(i){let s=t.x,e=t.y,h=t.z,r=t.w,n=i.x,a=i.y,m=i.z,o=i.w;this.x=s*o+r*n+e*m-h*a,this.y=e*o+r*a+h*n-s*m,this.z=h*o+r*m+s*a-e*n,this.w=r*o-s*n-e*a-h*m}else{let i=this.x,s=this.y,e=this.z,h=this.w,r=t.x,n=t.y,a=t.z,m=t.w;this.x=i*m+h*r+s*a-e*n,this.y=s*m+h*n+e*r-i*a,this.z=e*m+h*a+i*n-s*r,this.w=h*m-i*r-s*n-e*a}return this.onChange(),this},inverse:function(t=this){let i=t.x,s=t.y,e=t.z,h=t.w,r=i*i+s*s+e*e+h*h,n=r?1/r:0;return this.x=-i*n,this.y=-s*n,this.z=-e*n,this.w=h*n,this.onChange(),this},length:function(){let t=this.x,i=this.y,s=this.z,e=this.w;return Math.sqrt(t*t+i*i+s*s+e*e)},scale:function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},normalize:function(){let t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return t>0&&(t=1/Math.sqrt(t)),this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this.onChange(),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lerp:function(t,i){return this.x=this.x+i*(t.x-this.x),this.y=this.y+i*(t.y-this.y),this.z=this.z+i*(t.z-this.z),this.w=this.w+i*(t.w-this.w),this},slerp:function(t,i){let s,e,h,r,n,a=this.x,m=this.y,o=this.z,l=this.w,u=t.x,c=t.y,g=t.z,d=t.w;return e=a*u+m*c+o*g+l*d,e<0&&(e=-e,u=-u,c=-c,g=-g,d=-d),1-e>1e-6?(s=Math.acos(e),h=Math.sin(s),r=Math.sin((1-i)*s)/h,n=Math.sin(i*s)/h):(r=1-i,n=i),this.x=r*a+n*u,this.y=r*m+n*c,this.z=r*o+n*g,this.w=r*l+n*d,this},identity:function(){return this.x=0,this.y=0,this.z=0,this.w=1,this.onChange(),this},rotateX:function(t){t*=.5;let i=this.x,s=this.y,e=this.z,h=this.w,r=Math.sin(t),n=Math.cos(t);return this.x=i*n+h*r,this.y=s*n+e*r,this.z=e*n-s*r,this.w=h*n-i*r,this.onChange(),this},rotateY:function(t){t*=.5;let i=this.x,s=this.y,e=this.z,h=this.w,r=Math.sin(t),n=Math.cos(t);return this.x=i*n-e*r,this.y=s*n+h*r,this.z=e*n+i*r,this.w=h*n-s*r,this.onChange(),this},rotateZ:function(t){t*=.5;let i=this.x,s=this.y,e=this.z,h=this.w,r=Math.sin(t),n=Math.cos(t);return this.x=i*n+s*r,this.y=s*n-i*r,this.z=e*n+h*r,this.w=h*n-e*r,this.onChange(),this},conjugate:function(t=this){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this.onChange(),this},fromMatrix3:function(t){let i,s=t.toArray(),e=this.toArray(),h=s[0]+s[4]+s[8];if(h>0)i=Math.sqrt(h+1),e[3]=.5*i,i=.5/i,e[0]=(s[5]-s[7])*i,e[1]=(s[6]-s[2])*i,e[2]=(s[1]-s[3])*i;else{let t=0;s[4]>s[0]&&(t=1),s[8]>s[3*t+t]&&(t=2);let h=(t+1)%3,r=(t+2)%3;i=Math.sqrt(s[3*t+t]-s[3*h+h]-s[3*r+r]+1),e[t]=.5*i,i=.5/i,e[3]=(s[3*h+r]-s[3*r+h])*i,e[h]=(s[3*h+t]+s[3*t+h])*i,e[r]=(s[3*r+t]+s[3*t+r])*i}return this.fromArray(e),this.onChange(),this},fromEuler:function(t){let i=t.order||"YXZ",s=Math.sin(.5*t.x),e=Math.cos(.5*t.x),h=Math.sin(.5*t.y),r=Math.cos(.5*t.y),n=Math.sin(.5*t.z),a=Math.cos(.5*t.z);return"XYZ"===i?(this.x=s*r*a+e*h*n,this.y=e*h*a-s*r*n,this.z=e*r*n+s*h*a,this.w=e*r*a-s*h*n):"YXZ"===i?(this.x=s*r*a+e*h*n,this.y=e*h*a-s*r*n,this.z=e*r*n-s*h*a,this.w=e*r*a+s*h*n):"ZXY"===i?(this.x=s*r*a-e*h*n,this.y=e*h*a+s*r*n,this.z=e*r*n+s*h*a,this.w=e*r*a-s*h*n):"ZYX"===i?(this.x=s*r*a-e*h*n,this.y=e*h*a+s*r*n,this.z=e*r*n-s*h*a,this.w=e*r*a+s*h*n):"YZX"===i?(this.x=s*r*a+e*h*n,this.y=e*h*a+s*r*n,this.z=e*r*n-s*h*a,this.w=e*r*a-s*h*n):"XZY"===i&&(this.x=s*r*a-e*h*n,this.y=e*h*a-s*r*n,this.z=e*r*n+s*h*a,this.w=e*r*a+s*h*n),this},fromAxisAngle:function(t,i){rad*=.5;let s=Math.sin(rad);return this.x=s*t.x,this.y=s*t.y,this.z=s*t.z,this.w=Math.cos(rad),this},clone(){return new glw.Quaternion(this.x,this.y,this.z,this.w)},fromArray:function(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},glw.Color=function(t=0,i=0,s=0){this.r=t,this.g=i,this.b=s},glw.Color.prototype={constructor:glw.Color,setRGB:function(t,i,s){return this.r=t,this.g=i,this.b=s,this},setHSV:function(t,i,s){var e,h,r,n,a;return 0===s?this.r=this.g=this.b=0:(e=Math.floor(6*t),h=6*t-e,r=s*(1-i),n=s*(1-i*h),a=s*(1-i*(1-h)),0===e?(this.r=s,this.g=a,this.b=r):1===e?(this.r=n,this.g=s,this.b=r):2===e?(this.r=r,this.g=s,this.b=a):3===e?(this.r=r,this.g=n,this.b=s):4===e?(this.r=a,this.g=r,this.b=s):5===e&&(this.r=s,this.g=r,this.b=n)),this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},fromArray:function(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}},glw.RenderersCount=0,glw.ProgramsCount=0,glw.GeometriesCount=0,glw.GeometryAttributesCount=0,glw.MeshesCount=0,glw.TexturesCount=0,glw.Renderer=function({canvas:t=document.createElement("canvas"),width:i=300,height:s=150,dpr:e=1,alpha:h=!1,depth:r=!0,stencil:n=!1,antialias:a=!1,premultipliedAlpha:m=!1,preserveDrawingBuffer:o=!1,powerPreference:l="default",autoClear:u=!0,webgl:c=2}={}){const g=new glw.Vector3,d={alpha:h,depth:r,stencil:n,antialias:a,premultipliedAlpha:m,preserveDrawingBuffer:o,powerPreference:l};this.dpr=e,this.alpha=h,this.color=!0,this.depth=r,this.stencil=n,this.premultipliedAlpha=m,this.autoClear=u,this.id=glw.RenderersCount++,this.init=function(){2===c&&(this.gl=t.getContext("webgl2",d)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",d)||t.getContext("experimental-webgl",d)),this.gl.renderer=this,this.setSize(i,s),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},
this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.setSize=function(t,i){this.width=t,this.height=i,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=i*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:i+"px"})},this.setViewport=function(t,i){this.state.viewport.width===t&&this.state.viewport.height===i||(this.state.viewport.width=t,this.state.viewport.height=i,this.gl.viewport(0,0,t,i))},this.enable=function(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)},this.disable=function(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)},this.setBlendFunc=function(t,i,s,e){this.state.blendFunc.src===t&&this.state.blendFunc.dst===i&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===e||(this.state.blendFunc.src=t,this.state.blendFunc.dst=i,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=e,void 0!==s?this.gl.blendFuncSeparate(t,i,s,e):this.gl.blendFunc(t,i))},this.setBlendEquation=function(t,i){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===i||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=i,void 0!==i?this.gl.blendEquationSeparate(t,i):this.gl.blendEquation(t))},this.setCullFace=function(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))},this.setFrontFace=function(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))},this.setDepthMask=function(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))},this.setDepthFunc=function(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))},this.activeTexture=function(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))},this.bindFramebuffer=function({target:t=this.gl.FRAMEBUFFER,buffer:i=null}={}){this.state.framebuffer!==i&&(this.state.framebuffer=i,this.gl.bindFramebuffer(t,i))},this.getExtension=function(t,i,s){return i&&this.gl[i]?this.gl[i].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),i?this.extensions[t]?this.extensions[t][s].bind(this.extensions[t]):null:this.extensions[t])},this.sortOpaque=function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.program.id!==i.program.id?t.program.id-i.program.id:t.zDepth!==i.zDepth?t.zDepth-i.zDepth:i.id-t.id},this.sortTransparent=function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.zDepth!==i.zDepth?i.zDepth-t.zDepth:i.id-t.id},this.sortUI=function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.program.id!==i.program.id?t.program.id-i.program.id:i.id-t.id},this.getRenderList=function({scene:t,camera:i,frustumCull:s,sort:e}){let h=[];if(i&&s&&i.updateFrustum(),t.traverse(t=>{if(!t.visible)return!0;t.draw&&(s&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||h.push(t))}),e){const t=[],s=[],e=[];h.forEach(h=>{h.program.transparent?h.program.depthTest?s.push(h):e.push(h):t.push(h),h.zDepth=0,0===h.renderOrder&&h.program.depthTest&&i&&(h.worldMatrix.getTranslation(g),g.applyMatrix4(i.projectionViewMatrix),h.zDepth=g.z)}),t.sort(this.sortOpaque),s.sort(this.sortTransparent),e.sort(this.sortUI),h=t.concat(s,e)}return h},this.render=function({scene:t,camera:i,target:s=null,update:e=!0,sort:h=!0,frustumCull:r=!0,clear:n}){null===s?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(n||this.autoClear&&!1!==n)&&(!this.depth||s&&!s.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),e&&t.updateMatrixWorld(),i&&i.updateMatrixWorld();const a=this.getRenderList({scene:t,camera:i,frustumCull:r,sort:h});a.forEach(t=>{t.draw({camera:i})})},this.init()},glw.Program=function(t,{vertex:i,fragment:s,uniforms:e={},transparent:h=!1,cullFace:r=t.BACK,frontFace:n=t.CCW,depthTest:a=!0,depthWrite:m=!0,depthFunc:o=t.LESS}={}){function l(t,i,s,e){e=Array.isArray(e)?c(e):e;const h=t.renderer.state.uniformLocations.get(s);if(Array.isArray(e))if(void 0===h||h.length!==e.length)t.renderer.state.uniformLocations.set(s,e.slice(0));else{if(g(h,e))return;h.set?h.set(e):d(h,e),t.renderer.state.uniformLocations.set(s,h)}else{if(h===e)return;t.renderer.state.uniformLocations.set(s,e)}switch(i){case 5126:return Array.isArray(e)?t.uniform1fv(s,e):t.uniform1f(s,e);case 35664:return t.uniform2fv(s,Array.isArray(e)?e:e.toArray());case 35665:return t.uniform3fv(s,Array.isArray(e)?e:e.toArray());case 35666:return t.uniform4fv(s,e);case 35670:case 5124:case 35678:case 35680:return Array.isArray(e)?t.uniform1iv(s,e):t.uniform1i(s,e);case 35671:case 35667:return t.uniform2iv(s,e);case 35672:case 35668:return t.uniform3iv(s,e);case 35673:case 35669:return t.uniform4iv(s,e);case 35674:return t.uniformMatrix2fv(s,!1,Array.isArray(e)?e:e.toArray());case 35675:return t.uniformMatrix3fv(s,!1,Array.isArray(e)?e:e.toArray());case 35676:return t.uniformMatrix4fv(s,!1,Array.isArray(e)?e:e.toArray())}}function u(t){let i=t.split("\n");for(let t=0;t<i.length;t++)i[t]=t+1+": "+i[t];return i.join("\n")}function c(t){const i=t.length,s=t[0].length;if(void 0===s)return t;const e=i*s;let h=p[e];h||(p[e]=h=new Float32Array(e));for(let e=0;e<i;e++)h.set(t[e],e*s);return h}function g(t,i){if(t.length!==i.length)return!1;for(let s=0,e=t.length;s<e;s++)if(t[s]!==i[s])return!1;return!0}function d(t,i){for(let s=0,e=t.length;s<e;s++)t[s]=i[s]}function f(t){x>100||(console.warn(t),x++,x>100&&console.warn("More than 100 program warnings - stopping logs."))}const p={};this.init=function(){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=e,this.id=glw.ProgramsCount++,i||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=h,this.cullFace=r,this.frontFace=n,this.depthTest=a,this.depthWrite=m,this.depthFunc=o,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,i),t.compileShader(l),""!==t.getShaderInfoLog(l)&&console.warn(`${t.getShaderInfoLog(l)}\nVertex Shader\n${u(i)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,s),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${u(s)}`),this.program=t.createProgram(),t.attachShader(this.program,l),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(l),t.deleteShader(c),this.uniformLocations=new Map;let g=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let i=0;i<g;i++){let s=t.getActiveUniform(this.program,i);this.uniformLocations.set(s,t.getUniformLocation(this.program,s.name));const e=s.name.match(/(\w+)/g);s.uniformName=e[0],3===e.length?(s.isStructArray=!0,s.structIndex=Number(e[1]),s.structProperty=e[2]):2===e.length&&isNaN(Number(e[1]))&&(s.isStruct=!0,s.structProperty=e[1])}this.attributeLocations=new Map;const d=[],f=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let i=0;i<f;i++){const s=t.getActiveAttrib(this.program,i),e=t.getAttribLocation(this.program,s.name);d[e]=s.name,this.attributeLocations.set(s,e)}this.attributeOrder=d.join("")},this.setBlendFunc=function(t,i,s,e){this.blendFunc.src=t,this.blendFunc.dst=i,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=e,t&&(this.transparent=!0)},this.setBlendEquation=function(t,i){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=i},this.applyState=function(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)},this.use=function({flipFaces:t=!1}={}){let i=-1;const s=this.gl.renderer.currentProgram===this.id;s||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,s)=>{let e=s.uniformName,h=this.uniforms[e];if(s.isStruct&&(h=h[s.structProperty],e+=`.${s.structProperty}`),s.isStructArray&&(h=h[s.structIndex][s.structProperty],e+=`[${s.structIndex}].${s.structProperty}`),!h)return f(`Active uniform ${e} has not been supplied`);if(h&&void 0===h.value)return f(`${e} uniform is missing a value parameter`);if(h.value.texture)return i+=1,h.value.update(i),l(this.gl,s.type,t,i);if(Array.isArray(h.value)&&h.value[0].texture){const e=[];return h.value.forEach(t=>{i+=1,t.update(i),e.push(i)}),l(this.gl,s.type,t,e)}l(this.gl,s.type,t,h.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)},this.remove=function(){this.gl.deleteProgram(this.program)};let x=0;this.init()},glw.Camera=function({near:t=.1,far:i=100,fov:s=45,aspect:e=1,left:h,right:r,bottom:n,top:a,zoom:m=1}={}){this.parent=null,this.visible=!0,this.matrix=new glw.Matrix4,this.worldMatrix=new glw.Matrix4,this.matrixAutoUpdate=!0,this.position=new glw.Vector3,this.quaternion=new glw.Quaternion,this.scale=new glw.Vector3(1),this.rotation=new glw.Euler,this.up=new glw.Vector3(0,1,0),this.rotation.onChange=(()=>this.quaternion.fromEuler(this.rotation)),this.quaternion.onChange=(()=>this.rotation.fromQuaternion(this.quaternion)),this.updateMatrix=function(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0},this.traverse=function(t){t(this)},this.decompose=function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)},this.lookAt=function(t){return this.matrix.lookAt(this.position,t,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion),this};const o=new glw.Matrix4,l=new glw.Vector3,u=new glw.Vector3;Object.assign(this,{near:t,far:i,fov:s,aspect:e,left:h,right:r,bottom:n,top:a,zoom:m}),this.projectionMatrix=new glw.Matrix4,this.viewMatrix=new glw.Matrix4,this.projectionViewMatrix=new glw.Matrix4,this.worldPosition=new glw.Vector3,this.type=h||r?"orthographic":"perspective",this.init=function(){"orthographic"===this.type?this.orthographic():this.perspective()},this.perspective=function({near:t=this.near,far:i=this.far,fov:s=this.fov,aspect:e=this.aspect}={}){return Object.assign(this,{near:t,far:i,fov:s,aspect:e}),this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:e,near:t,far:i}),this.type="perspective",this},this.orthographic=function({near:t=this.near,far:i=this.far,left:s=this.left,right:e=this.right,bottom:h=this.bottom,top:r=this.top,zoom:n=this.zoom}={}){return Object.assign(this,{near:t,far:i,left:s,right:e,bottom:h,top:r,zoom:n}),s/=n,e/=n,h/=n,r/=n,this.projectionMatrix.fromOrthogonal({left:s,right:e,bottom:h,top:r,near:t,far:i}),this.type="orthographic",this},this.updateMatrixWorld=function(t){return this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this},this.project=function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this},this.unproject=function(t){return t.applyMatrix4(o.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this},this.updateFrustum=function(){this.frustum||(this.frustum=[new glw.Vector3,new glw.Vector3,new glw.Vector3,new glw.Vector3,new glw.Vector3,new glw.Vector3]);const t=this.projectionViewMatrix.toArray();this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const i=1/this.frustum[t].distance();this.frustum[t].multiply(i),this.frustum[t].constant*=i}},this.frustumIntersectsMesh=function(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const i=l;i.copy(t.geometry.bounds.center),i.applyMatrix4(t.worldMatrix);const s=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(i,s)},this.frustumIntersectsSphere=function(t,i){const s=u;for(let e=0;e<6;e++){const h=this.frustum[e],r=s.copy(h).dot(t)+h.constant;if(r<-i)return!1}return!0},this.init()},glw.Scene=function(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new glw.Matrix4,this.worldMatrix=new glw.Matrix4,this.matrixAutoUpdate=!0,this.position=new glw.Vector3,this.quaternion=new glw.Quaternion,this.scale=new glw.Vector3(1),this.rotation=new glw.Euler,this.up=new glw.Vector3(0,1,0),this.rotation.onChange=(()=>this.quaternion.fromEuler(this.rotation)),this.quaternion.onChange=(()=>this.rotation.fromQuaternion(this.quaternion)),this.add=function(t,i=!0){~this.children.indexOf(t)||this.children.push(t),i&&(t.parent=this)},this.remove=function(t,i=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),i&&(t.parent=null)},this.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let i=0,s=this.children.length;i<s;i++)this.children[i].updateMatrixWorld(t)},this.updateMatrix=function(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0},this.traverse=function(t){if(!t(this))for(let i=0,s=this.children.length;i<s;i++)this.children[i].traverse(t)},this.decompose=function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}},glw.OrbitControls=function(t,{element:i=document,enabled:s=!0,target:e=new glw.Vector3,ease:h=.25,inertia:r=.85,enableRotate:n=!0,rotateSpeed:a=.1,autoRotate:m=!1,autoRotateSpeed:o=1,enableZoom:l=!0,zoomSpeed:u=1,enablePan:c=!0,panSpeed:g=.1,minPolarAngle:d=0,maxPolarAngle:f=Math.PI,minAzimuthAngle:p=-1/0,maxAzimuthAngle:x=1/0,minDistance:y=0,maxDistance:w=1/0}={}){function M(){return Math.pow(.95,u)}function E(t,i){P.set(i.m00,i.m01,i.m02),P.multiply(-t),B.add(P)}function b(t,i){P.set(i.m10,i.m11,i.m12),P.multiply(t),B.add(P)}function A(t){L.radius/=t}function z(){const t=2*Math.PI/60/60*o;L.theta-=t}function v(t,s){N.set(t,s),O.sub(N,V).multiply(a);let e=i===document?document.body:i;L.theta-=2*Math.PI*O.x/e.clientHeight,L.phi-=2*Math.PI*O.y/e.clientHeight,V.copy(N)}function T(t){N.set(t.clientX,t.clientY),O.sub(N,X),O.y>0?A(M()):O.y<0&&A(1/M()),X.copy(N)}function R(t,i){N.set(t,i),O.sub(N,q).multiply(g),Y(O.x,O.y),q.copy(N)}function F(t){if(l){let i=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,e=Math.sqrt(i*i+s*s);X.set(0,e)}if(c){let i=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);q.set(i,s)}}function _(t){if(l){let i=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,e=Math.sqrt(i*i+s*s);N.set(0,e),O.set(0,Math.pow(N.y/X.y,u)),A(O.y),X.copy(N)}if(c){let i=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);R(i,s)}}function S(){i.addEventListener("contextmenu",K,!1),i.addEventListener("mousedown",k,!1),i.addEventListener("wheel",W,{passive:!1}),i.addEventListener("touchstart",Q,{passive:!1}),i.addEventListener("touchend",$,!1),i.addEventListener("touchmove",Z,{passive:!1})}const C={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},P=new glw.Vector3,N=new glw.Vector2,O=new glw.Vector2;this.enabled=s,this.target=e,h=h||1,r=r||0,this.minDistance=y,this.maxDistance=w;const L={radius:1,phi:0,theta:0},U={radius:1,phi:0,theta:0},D={radius:1,phi:0,theta:0},B=new glw.Vector3,I=new glw.Vector3;I.copy(t.position).sub(this.target),D.radius=U.radius=I.distance(),D.theta=U.theta=Math.atan2(I.x,I.z),D.phi=U.phi=Math.acos(Math.min(Math.max(I.y/U.radius,-1),1)),this.offset=I,this.update=(()=>{m&&z(),U.radius*=L.radius,U.theta+=L.theta,U.phi+=L.phi,U.theta=Math.max(p,Math.min(x,U.theta)),U.phi=Math.max(d,Math.min(f,U.phi)),U.radius=Math.max(this.minDistance,Math.min(this.maxDistance,U.radius)),D.phi+=(U.phi-D.phi)*h,D.theta+=(U.theta-D.theta)*h,D.radius+=(U.radius-D.radius)*h,this.target.add(B);let i=D.radius*Math.sin(Math.max(1e-6,D.phi));I.x=i*Math.sin(D.theta),I.y=D.radius*Math.cos(D.phi),I.z=i*Math.cos(D.theta),t.position.copy(this.target).add(I),t.lookAt(this.target),L.theta*=r,L.phi*=r,B.multiply(r),L.radius=1}),this.forcePosition=(()=>{I.copy(t.position).sub(this.target),D.radius=U.radius=I.distance(),D.theta=U.theta=Math.atan2(I.x,I.z),D.phi=U.phi=Math.acos(Math.min(Math.max(I.y/U.radius,-1),1)),t.lookAt(this.target)});const V=new glw.Vector2,q=new glw.Vector2,X=new glw.Vector2;let G=C.NONE;this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const Y=(s,e)=>{let h=i===document?document.body:i;P.copy(t.position).sub(this.target);let r=P.distance();r*=Math.tan((t.fov||45)/2*Math.PI/180),E(2*s*r/h.clientHeight,t.matrix),b(2*e*r/h.clientHeight,t.matrix)},k=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===n)return;V.set(t.clientX,t.clientY),G=C.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===l)return;X.set(t.clientX,t.clientY),G=C.DOLLY;break;case this.mouseButtons.PAN:if(!1===c)return;q.set(t.clientX,t.clientY),G=C.PAN}G!==C.NONE&&(window.addEventListener("mousemove",j,!1),window.addEventListener("mouseup",H,!1))}},j=t=>{if(this.enabled)switch(G){case C.ROTATE:if(!1===n)return;v(t.clientX,t.clientY);break;case C.DOLLY:if(!1===l)return;T(t);break;case C.PAN:if(!1===c)return;R(t.clientX,t.clientY)}},H=()=>{window.removeEventListener("mousemove",j,!1),window.removeEventListener("mouseup",H,!1),G=C.NONE},W=t=>{this.enabled&&l&&(G===C.NONE||G===C.ROTATE)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?A(1/M()):t.deltaY>0&&A(M()))},Q=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===n)return;V.set(t.touches[0].pageX,t.touches[0].pageY),G=C.ROTATE;break;case 2:if(!1===l&&!1===c)return;F(t),G=C.DOLLY_PAN;break;default:G=C.NONE}},Z=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===n)return;v(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===l&&!1===c)return;_(t);break;default:G=C.NONE}},$=()=>{this.enabled&&(G=C.NONE)},K=t=>{this.enabled&&t.preventDefault()};this.remove=function(){i.removeEventListener("contextmenu",K),i.removeEventListener("mousedown",k),i.removeEventListener("wheel",W),i.removeEventListener("touchstart",Q),i.removeEventListener("touchend",$),i.removeEventListener("touchmove",Z),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",H)},S()},glw.Geometry=function(t,i={}){const s=new glw.Vector3;let e=!1;t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=i,this.id=glw.GeometriesCount++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,this.addAttribute=function(t,s){if(i[t]=s,s.id=glw.GeometryAttributesCount++,s.size=s.size||1,s.type=s.type||(s.data.constructor===Float32Array?this.gl.FLOAT:s.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),s.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,s.normalized=s.normalized||!1,s.stride=s.stride||0,s.offset=s.offset||0,s.count=s.count||(s.stride?s.data.byteLength/s.stride:s.data.length/s.size),s.divisor=s.instanced||0,s.needsUpdate=!1,s.buffer||(s.buffer=this.gl.createBuffer(),this.updateAttribute(s)),s.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==s.count*s.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,s.count*s.divisor);this.instancedCount=s.count*s.divisor}else"index"===t?this.drawRange.count=s.count:i.index||(this.drawRange.count=Math.max(this.drawRange.count,s.count))},this.updateAttribute=function(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1},this.setIndex=function(t){this.addAttribute("index",t)},this.setDrawRange=function(t,i){this.drawRange.start=t,this.drawRange.count=i},this.setInstancedCount=function(t){this.instancedCount=t},this.createVAO=function(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)},this.bindAttributes=function(t){t.attributeLocations.forEach((t,{name:s,type:e})=>{if(!i[s])return void console.warn(`active attribute ${s} not being supplied`);const h=i[s];this.gl.bindBuffer(h.target,h.buffer),this.glState.boundBuffer=h.buffer;let r=1;35674===e&&(r=2),35675===e&&(r=3),35676===e&&(r=4);const n=h.size/r,a=1===r?0:r*r*r,m=1===r?0:r*r;for(let i=0;i<r;i++)this.gl.vertexAttribPointer(t+i,n,h.type,h.normalized,h.stride+a,h.offset+i*m),this.gl.enableVertexAttribArray(t+i),this.gl.renderer.vertexAttribDivisor(t+i,h.divisor)}),i.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,i.index.buffer)},this.draw=function({program:t,mode:s=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach((t,{name:s})=>{const e=i[s];e.needsUpdate&&this.updateAttribute(e)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(s,this.drawRange.count,i.index.type,i.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(s,this.drawRange.start,this.drawRange.count,this.instancedCount):i.index?this.gl.drawElements(s,this.drawRange.count,i.index.type,i.index.offset+2*this.drawRange.start):this.gl.drawArrays(s,this.drawRange.start,this.drawRange.count)},this.getPositionArray=function(){const t=i.position;return t.data?t.data:e?void 0:(console.warn("No position buffer data found to compute bounds"),e=!0)},this.computeBoundingBox=function(t){t||(t=this.getPositionArray()),this.bounds||(this.bounds={min:new glw.Vector3,max:new glw.Vector3,center:new glw.Vector3,scale:new glw.Vector3,radius:1/0});const i=this.bounds.min,s=this.bounds.max,e=this.bounds.center,h=this.bounds.scale;i.set(1/0),s.set(-1/0);for(let e=0,h=t.length;e<h;e+=3){const h=t[e],r=t[e+1],n=t[e+2];i.x=Math.min(h,i.x),i.y=Math.min(r,i.y),i.z=Math.min(n,i.z),s.x=Math.max(h,s.x),s.y=Math.max(r,s.y),s.z=Math.max(n,s.z)}h.sub(s,i),e.add(i,s).divide(2)},this.computeBoundingSphere=function(t){t||(t=this.getPositionArray()),this.bounds||this.computeBoundingBox(t);let i=0;for(let e=0,h=t.length;e<h;e+=3)s.fromArray(t,e),i=Math.max(i,this.bounds.center.squaredDistance(s));this.bounds.radius=Math.sqrt(i)},this.remove=function(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let t in i)this.gl.deleteBuffer(this.attributes[t].buffer),delete i[t]};for(let t in i)this.addAttribute(t,i[t])},glw.Mesh=function(t,{geometry:i,program:s,mode:e=t.TRIANGLES,frustumCulled:h=!0,renderOrder:r=0}={}){this.parent=null,this.visible=!0,this.matrix=new glw.Matrix4,this.worldMatrix=new glw.Matrix4,this.matrixAutoUpdate=!0,this.position=new glw.Vector3,this.quaternion=new glw.Quaternion,this.scale=new glw.Vector3(1),this.rotation=new glw.Euler,this.up=new glw.Vector3(0,1,0),this.rotation.onChange=(()=>this.quaternion.fromEuler(this.rotation)),this.quaternion.onChange=(()=>this.rotation.fromQuaternion(this.quaternion)),this.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0)},this.updateMatrix=function(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0},this.traverse=function(t){t(this)},this.decompose=function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)},t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=glw.MeshesCount++,this.geometry=i,this.program=s,this.mode=e,this.frustumCulled=h,this.renderOrder=r,this.modelViewMatrix=new glw.Matrix4,this.normalMatrix=new glw.Matrix3,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[],this.onBeforeRender=function(t){return this.beforeRenderCallbacks.push(t),this},this.onAfterRender=function(t){return this.afterRenderCallbacks.push(t),this},this.draw=function({camera:t}={}){this.beforeRenderCallbacks.forEach(i=>i&&i({mesh:this,camera:t})),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix.toArray(),this.program.uniforms.cameraPosition.value=t.worldPosition.toArray(),this.program.uniforms.viewMatrix.value=t.viewMatrix.toArray(),this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix.toArray(),this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix.toArray(),this.program.uniforms.normalMatrix.value=this.normalMatrix.toArray());let i=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:i}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(i=>i&&i({mesh:this,camera:t}))}},glw.Texture=function(t,{image:i,target:s=t.TEXTURE_2D,type:e=t.UNSIGNED_BYTE,format:h=t.RGBA,internalFormat:r=h,wrapS:n=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,generateMipmaps:m=!0,minFilter:o=(m?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:l=t.LINEAR,premultiplyAlpha:u=!1,unpackAlignment:c=4,flipY:g=s==t.TEXTURE_2D,anisotropy:d=0,level:f=0,width:p,height:x=p}={}){function y(t){return 0==(t&t-1)}const w=new Uint8Array(4);this.gl=t,this.id=glw.TexturesCount++,this.image=i,this.target=s,this.type=e,this.format=h,this.internalFormat=r,this.minFilter=o,this.magFilter=l,this.wrapS=n,this.wrapT=a,this.generateMipmaps=m,this.premultiplyAlpha=u,this.unpackAlignment=c,this.flipY=g,this.anisotropy=Math.min(d,this.gl.renderer.parameters.maxAnisotropy),this.level=f,this.width=p,this.height=x,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0,this.bind=function(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)},this.update=function(t=0){const i=!(this.image===this.store.image&&!this.needsUpdate);if((i||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),i){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),
this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||y(this.image.width)&&y(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,w);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,w);this.store.image=this.image}}},glw.RenderTarget=function(t,{width:i=t.canvas.width,height:s=t.canvas.height,target:e=t.FRAMEBUFFER,color:h=1,depth:r=!0,stencil:n=!1,depthTexture:a=!1,wrapS:m=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,minFilter:l=t.LINEAR,magFilter:u=l,type:c=t.UNSIGNED_BYTE,format:g=t.RGBA,internalFormat:d=g,unpackAlignment:f,premultiplyAlpha:p}={}){this.gl=t,this.width=i,this.height=s,this.depth=r,this.buffer=this.gl.createFramebuffer(),this.target=e,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const x=[];for(let e=0;e<h;e++)this.textures.push(new glw.Texture(t,{width:i,height:s,wrapS:m,wrapT:o,minFilter:l,magFilter:u,type:c,format:g,internalFormat:d,unpackAlignment:f,premultiplyAlpha:p,flipY:!1,generateMipmaps:!1})),this.textures[e].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+e,this.gl.TEXTURE_2D,this.textures[e].texture,0),x.push(this.gl.COLOR_ATTACHMENT0+e);x.length>1&&this.gl.renderer.drawBuffers(x),this.texture=this.textures[0],a&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new glw.Texture(t,{width:i,height:s,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(r&&!n&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,i,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),n&&!r&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,i,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),r&&n&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,i,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)},glw.Plane=function(t,{width:i=1,height:s=1,widthSegments:e=1,heightSegments:h=1,attributes:r={}}={}){const n=e,a=h,m=(n+1)*(a+1),o=n*a*6,l=new Float32Array(3*m),u=new Float32Array(3*m),c=new Float32Array(2*m),g=m>65536?new Uint32Array(o):new Uint16Array(o);return buildPlane=function(t,i,s,e,h,r,n,a,m,o=0,l=1,u=2,c=1,g=-1,d=0,f=0){const p=d,x=h/a,y=r/m;for(let w=0;w<=m;w++){let M=w*y-r/2;for(let r=0;r<=a;r++,d++){let y=r*x-h/2;if(t[3*d+o]=y*c,t[3*d+l]=M*g,t[3*d+u]=n/2,i[3*d+o]=0,i[3*d+l]=0,i[3*d+u]=n>=0?1:-1,s[2*d]=r/a,s[2*d+1]=1-w/m,w===m||r===a)continue;let E=p+r+w*(a+1),b=p+r+(w+1)*(a+1),A=p+r+(w+1)*(a+1)+1,z=p+r+w*(a+1)+1;e[6*f]=E,e[6*f+1]=b,e[6*f+2]=z,e[6*f+3]=b,e[6*f+4]=A,e[6*f+5]=z,f++}}},buildPlane(l,u,c,g,i,s,0,n,a),Object.assign(r,{position:{size:3,data:l},normal:{size:3,data:u},uv:{size:2,data:c},index:{data:g}}),new glw.Geometry(t,r)},glw.Box=function(t,{width:i=1,height:s=1,depth:e=1,widthSegments:h=1,heightSegments:r=1,depthSegments:n=1,attributes:a={}}={}){const m=h,o=r,l=n,u=(m+1)*(o+1)*2+(m+1)*(l+1)*2+(o+1)*(l+1)*2,c=6*(m*o*2+m*l*2+o*l*2),g=new Float32Array(3*u),d=new Float32Array(3*u),f=new Float32Array(2*u),p=u>65536?new Uint32Array(c):new Uint16Array(c);let x=0,y=0;return buildPlane=function(t,i,s,e,h,r,n,a,m,o=0,l=1,u=2,c=1,g=-1,d=0,f=0){const p=d,x=h/a,y=r/m;for(let w=0;w<=m;w++){let M=w*y-r/2;for(let r=0;r<=a;r++,d++){let y=r*x-h/2;if(t[3*d+o]=y*c,t[3*d+l]=M*g,t[3*d+u]=n/2,i[3*d+o]=0,i[3*d+l]=0,i[3*d+u]=n>=0?1:-1,s[2*d]=r/a,s[2*d+1]=1-w/m,w===m||r===a)continue;let E=p+r+w*(a+1),b=p+r+(w+1)*(a+1),A=p+r+(w+1)*(a+1)+1,z=p+r+w*(a+1)+1;e[6*f]=E,e[6*f+1]=b,e[6*f+2]=z,e[6*f+3]=b,e[6*f+4]=A,e[6*f+5]=z,f++}}},buildPlane(g,d,f,p,e,s,i,l,o,2,1,0,-1,-1,x,y),buildPlane(g,d,f,p,e,s,-i,l,o,2,1,0,1,-1,x+=(l+1)*(o+1),y+=l*o),buildPlane(g,d,f,p,i,e,s,l,o,0,2,1,1,1,x+=(l+1)*(o+1),y+=l*o),buildPlane(g,d,f,p,i,e,-s,l,o,0,2,1,1,-1,x+=(m+1)*(l+1),y+=m*l),buildPlane(g,d,f,p,i,s,-e,m,o,0,1,2,-1,-1,x+=(m+1)*(l+1),y+=m*l),buildPlane(g,d,f,p,i,s,e,m,o,0,1,2,1,-1,x+=(m+1)*(o+1),y+=m*o),Object.assign(a,{position:{size:3,data:g},normal:{size:3,data:d},uv:{size:2,data:f},index:{data:p}}),new glw.Geometry(t,a)},glw.Sphere=function(t,{radius:i=.5,widthSegments:s=16,heightSegments:e=Math.ceil(.5*s),phiStart:h=0,phiLength:r=2*Math.PI,thetaStart:n=0,thetaLength:a=Math.PI,attributes:m={}}={}){const o=s,l=e,u=h,c=r,g=n,d=a,f=(o+1)*(l+1),p=o*l*6,x=new Float32Array(3*f),y=new Float32Array(3*f),w=new Float32Array(2*f),M=f>65536?new Uint32Array(p):new Uint16Array(p);let E=0,b=0,A=0,z=g+d;const v=[];let T=new glw.Vector3;for(let t=0;t<=l;t++){let s=[],e=t/l;for(let t=0;t<=o;t++,E++){let h=t/o,r=-i*Math.cos(u+h*c)*Math.sin(g+e*d),n=i*Math.cos(g+e*d),a=i*Math.sin(u+h*c)*Math.sin(g+e*d);x[3*E]=r,x[3*E+1]=n,x[3*E+2]=a,T.set(r,n,a).normalize(),y[3*E]=T.x,y[3*E+1]=T.y,y[3*E+2]=T.z,w[2*E]=h,w[2*E+1]=1-e,s.push(b++)}v.push(s)}for(let t=0;t<l;t++)for(let i=0;i<o;i++){let s=v[t][i+1],e=v[t][i],h=v[t+1][i],r=v[t+1][i+1];(0!==t||g>0)&&(M[3*A]=s,M[3*A+1]=e,M[3*A+2]=r,A++),(t!==l-1||z<Math.PI)&&(M[3*A]=e,M[3*A+1]=h,M[3*A+2]=r,A++)}return Object.assign(m,{position:{size:3,data:x},normal:{size:3,data:y},uv:{size:2,data:w},index:{data:M}}),new glw.Geometry(t,m)},glw.Triangle=function(t,{attributes:i={}}={}){return Object.assign(i,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),new glw.Geometry(t,i)},glw.Post=function(t,{width:i,height:s,dpr:e,wrapS:h=t.CLAMP_TO_EDGE,wrapT:r=t.CLAMP_TO_EDGE,minFilter:n=t.LINEAR,magFilter:a=t.LINEAR,geometry:m=new glw.Triangle(t),targetOnly:o=null}={}){this.gl=t,this.options={wrapS:h,wrapT:r,minFilter:n,magFilter:a},this.passes=[],this.geometry=m,this.uniform={value:null},this.targetOnly=o;const l="\n\t\tattribute vec2 uv;\n\t\tattribute vec2 position;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = vec4(position, 0, 1);\n\t\t}\n\t",u="\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tMap;\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(tMap, vUv);\n\t\t}\n\t",c=this.fbo={read:null,write:null,swap:()=>{let t=c.read;c.read=c.write,c.write=t}};this.addPass=function({vertex:t=l,fragment:i=u,uniforms:s={},textureUniform:e="tMap",enabled:h=!0}={}){s[e]={value:this.fbo.read.texture};const r=new glw.Program(this.gl,{vertex:t,fragment:i,uniforms:s}),n=new glw.Mesh(this.gl,{geometry:this.geometry,program:r}),a={mesh:n,program:r,uniforms:s,enabled:h,textureUniform:e};return this.passes.push(a),a},this.resize=function({width:t,height:i,dpr:s}={}){s&&(this.dpr=s),t&&(this.width=t,this.height=i||t),s=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*s,i=(this.height||this.gl.renderer.height)*s,this.options.width=t,this.options.height=i,this.fbo.read=new glw.RenderTarget(this.gl,this.options),this.fbo.write=new glw.RenderTarget(this.gl,this.options)},this.render=function({scene:t,camera:i,target:s=null,update:e=!0,sort:h=!0,frustumCull:r=!0}){const n=this.passes.filter(t=>t.enabled);this.gl.renderer.render({scene:t,camera:i,target:n.length||!s&&this.targetOnly?this.fbo.write:s,update:e,sort:h,frustumCull:r}),this.fbo.swap(),n.forEach((t,i)=>{t.mesh.program.uniforms[t.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:t.mesh,target:i!==n.length-1||!s&&this.targetOnly?this.fbo.write:s,clear:!0}),this.fbo.swap()}),this.uniform.value=this.fbo.read.texture},this.resize({width:i,height:s,dpr:e})},glw.Stats=function(){function t(t){return e.appendChild(t.dom),t}function i(t){for(var i=0;i<e.children.length;i++)e.children[i].style.display=i===t?"block":"none";s=t}var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(t){t.preventDefault(),i(++s%e.children.length)},!1);var h=(performance||Date).now(),r=h,n=0,a=t(new glw.Stats.Panel("FPS","#0ff","#002")),m=t(new glw.Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var o=t(new glw.Stats.Panel("MB","#f08","#201"));return i(0),{dom:e,addPanel:t,showPanel:i,begin:function(){h=(performance||Date).now()},end:function(){n++;var t=(performance||Date).now();if(m.update(t-h,200),t>=r+1e3&&(a.update(1e3*n/(t-r),100),r=t,n=0,o)){var i=performance.memory;o.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return t},update:function(){h=this.end()},domElement:e,setMode:i}},glw.Stats.Panel=function(t,i,s){var e=1/0,h=0,r=Math.round,n=r(window.devicePixelRatio||1),a=80*n,m=48*n,o=3*n,l=2*n,u=3*n,c=15*n,g=74*n,d=30*n,f=document.createElement("canvas");f.width=a,f.height=m,f.style.cssText="width:80px;height:48px";var p=f.getContext("2d");return p.font="bold "+9*n+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=s,p.fillRect(0,0,a,m),p.fillStyle=i,p.fillText(t,o,l),p.fillRect(u,c,g,d),p.fillStyle=s,p.globalAlpha=.9,p.fillRect(u,c,g,d),{dom:f,update:function(m,x){e=Math.min(e,m),h=Math.max(h,m),p.fillStyle=s,p.globalAlpha=1,p.fillRect(0,0,a,c),p.fillStyle=i,p.fillText(r(m)+" "+t+" ("+r(e)+"-"+r(h)+")",o,l),p.drawImage(f,u+n,c,g-n,d,u,c,g-n,d),p.fillRect(u+g-n,c,n,d),p.fillStyle=s,p.globalAlpha=.9,p.fillRect(u+g-n,c,n,r((1-m/x)*d))}}};